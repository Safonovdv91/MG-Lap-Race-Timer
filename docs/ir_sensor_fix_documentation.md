# Исправление логики работы ИК сенсоров

## Проблема
При использовании ИК сенсоров с модуляцией наблюдается ошибка: когда ИК луч свободен (не пересечен), датчик показывает, что луч пересечен, и только при физическом пересечении луча срабатывает корректное состояние.

## Причина
Проблема заключалась в неправильной логике обработки сигнала от ИК приемников TSOP38238:

1. Приемник TSOP38238 выдает LOW, когда ИК луч попадает на него (сигнал модулирован на 38 кГц)
2. При пересечении луча (блокировке сигнала) на выходе приемника появляется HIGH
3. Прерывания были настроены на срабатывание по спадающему фронту (FALLING), но ИК луч в нормальном состоянии дает LOW
4. Также была проблема в логике обновления состояния датчиков (sensor1Active, sensor2Active)

## Решение

### 1. Изменение типа прерывания
В файле `src/main.cpp` тип прерывания для ИК сенсоров изменен с `FALLING` на `RISING`:
- В нормальном состоянии (луч свободен): на пине LOW
- При пересечении луча (сигнал заблокирован): на пине HIGH
- Прерывание срабатывает по положительному фронту (RISING) при пересечении луча

### 2. Исправление логики обработки прерываний
В файле `src/measurements.cpp` исправлены функции `handleSensor1()` и `handleSensor2()`:
- Убрана проверка `if (!isIRBeamBlockedX()) return;`, которая блокировала обработку прерываний
- Правильно установлено обновление состояния `sensorXActive = true` при срабатывании прерывания

### 3. Исправление логики отображения состояния датчиков
В файле `src/measurements.cpp` в функции `updateSensorDisplay()`:
- Для ИК сенсоров: `sensorXActive = isIRBeamBlockedX()` - true, когда луч заблокирован
- Для механических датчиков: прежняя логика с таймаутом 3 секунды

## Результат
Теперь ИК сенсоры корректно работают:
- При свободном луче: датчик показывает, что луч не пересечен
- При пересечении луча: датчик регистрирует событие и показывает, что луч пересечен
- Прерывания срабатывают только при пересечении луча, а не при его восстановлении

## Тестирование
Для проверки работы рекомендуется:
1. Загрузить прошивку с определением `USE_IR_SENSORS`
2. Подключить ИК передатчики и приемники по схеме
3. Проверить, что при свободном луче датчики не активны
4. Проверить, что при пересечении луча датчики корректно срабатывают