# SFMgTimer - Система тайминга с ИК-сенсорами

## Описание проекта

Этот проект представляет собой систему тайминга для спортивных соревнований, разделенную на две независимые части:

1. **Излучатель (Transmitter)** - ESP32, которая генерирует ИК-сигнал и передает телеметрию о состоянии батареи по Wi-Fi
2. **Приемник (Receiver)** - ESP32, которая принимает ИК-сигнал, обнаруживает пересечение луча и предоставляет веб-интерфейс для отображения результатов

## Архитектура

### Излучатель (Transmitter)
- Инициализирует и управляет ИК-передатчиками (пины 13 и 12)
- Генерирует ИК-сигнал с частотой 38 кГц
- Подключается к Wi-Fi сети
- Отправляет телеметрию о состоянии батареи на приемник по UDP каждые 5 секунд
- Использует флаг `-DTRANSMITTER_MODE` при компиляции

### Приемник (Receiver)
- Инициализирует ИК-приемники (пины 14 и 27)
- Обрабатывает прерывания от датчиков при пересечении ИК-луча
- Предоставляет веб-интерфейс для отображения результатов
- Принимает телеметрию от излучателя по UDP
- Использует флаг `-DRECEIVER_MODE` при компиляции

## Компиляция и загрузка

### Для излучателя:
```bash
pio run -e transmitter -t upload
```

### Для приемника:
```bash
pio run -e receiver -t upload
```

## Протокол связи

Излучатель отправляет телеметрию в формате:
```
TELEMETRY:battery_level:voltage.V
```

Например: `TELEMETRY:75:3.95V`

## Пины

### Излучатель:
- IR_TX1_PIN: GPIO13
- IR_TX2_PIN: GPIO12
- BATTERY_PIN: GPIO34

### Приемник:
- SENSOR1_PIN: GPIO14
- SENSOR2_PIN: GPIO27
- STATUS_LED_PIN: GPIO2
- MEASUREMENT_LED_PIN: GPIO4
- BATTERY_PIN: GPIO34

## Веб-интерфейс

После запуска приемник создает точку доступа Wi-Fi с именем `chrono.mg`.
Веб-интерфейс доступен по адресу `http://192.168.4.1`

## Конфигурация Wi-Fi

По умолчанию используется SSID: `SFMTimer` и пароль: `123456789` для обеих ESP32.